import subprocess
import requests

def get_device_type(mac_address):
    url = "https://api.macvendors.com/"+mac_address
    response = requests.get(url)
    if response.status_code == 200:
        vendor = response.text.strip()
        if "Apple" in vendor:
            return "Apple"  # Example: Apple devices are classified as phones
        else:
            return "PC or Phone"  # Example: Non-Apple devices are classified as PCs
    return "Unknown"

# Run the arp command to retrieve the list of connected devices
arp_command = ['arp', '-a']
process = subprocess.Popen(arp_command, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
output, error = process.communicate()

# Check if the command was successful
if process.returncode == 0:
    # Decode the output from bytes to string
    output_str = output.decode('utf-8')

    # Split the output into lines
    lines = output_str.splitlines()

    # Print the list of connected devices
    print('Connected devices:')
    for line in lines:
        # Extract the IP address and MAC address from each line
        parts = line.split()
        if len(parts) >= 4:
            ip_address = parts[1].strip('()')
            mac_address = parts[3]

            # Determine the device type based on the MAC address
            device_type = get_device_type(mac_address)

            # Print the IP address and device type
            print('IP:'+ ip_address+' | Device Type:' + device_type)
else:
    print('An error occurred while retrieving connected devices.')
    print('Error:', error.decode('utf-8'))