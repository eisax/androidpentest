import subprocess
import io

# Connect to the Android device over Wi-Fi
adb_connect_command = ['adb', 'connect', '224.0.0.251:5555']
subprocess.Popen(adb_connect_command, stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()

# Construct the ADB command to retrieve SMS messages
adb_command = ['adb', 'shell', 'content', 'query', '--uri', 'content://sms']

# Execute the ADB command to retrieve SMS messages
process = subprocess.Popen(adb_command, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
output, error = process.communicate()

# Check if the command was successful
if process.returncode == 0:
    # Decode the output from bytes to string
    output_str = output.decode('utf-8')

    # Save the SMS messages in a text file
    with io.open('sms_messages.txt', 'w', encoding='utf-8') as file:
        file.write(output_str)

    print('SMS messages successfully saved in sms_messages.txt.')
else:
    print('An error occurred while retrieving SMS messages.')
    print('Error:', error.decode('utf-8'))