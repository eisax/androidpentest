import subprocess
import socket

# Specify the IP address and port of the device you want to send a message to
device_ip = '192.168.88.102'
port = 5555

# Run the ping command to check the connectivity to the device
ping_command = ['ping', '-c', '4', device_ip]  # '-c' specifies the number of pings to send
process = subprocess.Popen(ping_command, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
output, error = process.communicate()

# Check if the ping was successful
if process.returncode == 0:
    print("Device with IP address", device_ip, "is reachable.")

    # Create a socket object and connect to the device
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        sock.connect((device_ip, port))

        # Send a message to the device
        message = "Hello, device! How are you doing?"
        sock.sendall(message.encode())

        print("Message sent successfully to", device_ip)
    except Exception as e:
        print("Failed to connect to device with IP address", device_ip)
        print("Error:", str(e))
    finally:
        sock.close()
else:
    print("Device with IP address", device_ip, "is not reachable.")
    print('Error:', error.decode('utf-8'))