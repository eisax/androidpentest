import subprocess
import io

# Connect to the Android device via USB
adb_connect_command = ['adb', 'devices']
subprocess.Popen(adb_connect_command, stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()

# Construct the ADB command to retrieve USB-connected devices
adb_command = ['adb', 'shell', 'dumpsys', 'usb', '|', 'grep', 'Device']

# Execute the ADB command to retrieve USB-connected devices
process = subprocess.Popen(' '.join(adb_command), stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True)
output, error = process.communicate()

# Check if the command was successful
if process.returncode == 0:
    # Decode the output from bytes to string
    output_str = output.decode('utf-8')

    # Save the USB-connected devices in a text file
    with io.open('usb_devices.txt', 'w', encoding='utf-8') as file:
        file.write(output_str)

    print('USB-connected devices successfully saved in usb_devices.txt.')
else:
    print('An error occurred while retrieving USB-connected devices.')
    print('Error:', error.decode('utf-8'))